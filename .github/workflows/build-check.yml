name: Build Check

on:
  push:
    branches: [ '**' ]
  pull_request:
    branches: [ master ]

jobs:
  build-check:
    name: Check Build
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        submodules: recursive
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.8'
    
    - name: Check Python version
      run: |
        python --version
        pip --version
    
    - name: Install minimal dependencies
      run: |
        python -m pip install --upgrade pip
        pip install numpy pysam pyBigWig
    
    - name: Check imports
      run: |
        python -c "import numpy; print(f'NumPy: {numpy.__version__}')"
        python -c "import pysam; print(f'pysam: {pysam.__version__}')"
        python -c "import pyBigWig; print('pyBigWig: OK')"
    
    - name: Check BitArray
      run: |
        cd external/BitArray
        make --version
        gcc --version
        make clean
        make libbitarr.a
        ls -la libbitarr.a
    
    - name: Test setup.py
      run: |
        python setup.py --version
        python setup.py --help-commands